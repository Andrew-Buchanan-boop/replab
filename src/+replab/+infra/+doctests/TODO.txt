1) Restore test extraction

Move extraction stuff from writeDocTests to namedTestsInElement.
Pay attention to test naming, and to line numbers with their offsets.

2) Restore test writing according to the old convention

Run the old tests

3) Add support for flags, tolerance, double parsing
